"use strict";var __awaiter=this&&this.__awaiter||function(s,i,a,u){return new(a||(a=Promise))(function(e,t){function n(e){try{o(u.next(e))}catch(e){t(e)}}function r(e){try{o(u.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(n,r)}o((u=u.apply(s,i||[])).next())})},__generator=this&&this.__generator||function(n,r){var o,s,i,e,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,s&&(i=s[2&t[0]?"return":t[0]?"throw":"next"])&&!(i=i.call(s,t[1])).done)return i;switch(s=0,i&&(t=[0,i.value]),t[0]){case 0:case 1:i=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,s=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){a.label=t[1];break}if(6===t[0]&&a.label<i[1]){a.label=i[1],i=t;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(t);break}i[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(n,a)}catch(e){t=[6,e],s=0}finally{o=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};function getMeta(e){var t=document.querySelector('link[rel="'+e+'"]');return t?t.getAttribute("href"):null}!function(){window.dispatchEvent(new CustomEvent(browserAPI.runtime.id+"-install")),document.addEventListener("stylishInstallChrome",s),document.addEventListener("stylishUpdateChrome",s),a().then(function(){window.postMessage({direction:"from-content-script",message:"StylishInstalled"},"*")});var o,n,t=!1;function e(){if(!t){if(!document.body)return;t=!0,document.title=document.title.replace(/^(\d+)&\w+=/,"#$1: ");var e=getMeta("stylish-id-url")||location.href;browserAPI.runtime.sendMessage({type:"getStyles",data:{url:e}}).then(r)}document.getElementById("install_button")&&a().then(function(){requestAnimationFrame(function(){c(o)})})}function r(e){var t=e[0],n=t&&"local"!==t.node.nodeInfo.source&&t.node.nodeInfo.source.updateURL;document.dispatchEvent(new CustomEvent("stylusFixBuggyUSOsettings",{detail:n})),c(t?{type:"updatable"===t.state?"styleCanBeUpdatedChrome":"styleAlreadyInstalledChrome",detail:{updateUrl:n}}:{type:"styleCanBeInstalledChrome"})}function c(e){var t=(o=e).type,n=e.detail,r=void 0===n?null:n;r={detail:r},a().then(function(){document.dispatchEvent(new CustomEvent(t,r))})}function s(e){function t(){setTimeout(function(){n=!1})}n||(n=!0,(-1!==e.type.indexOf("Update")?new Promise(function(n,r){var e=getMeta("stylish-id-url")||location.href;browserAPI.runtime.sendMessage({type:"getStyles",data:{url:e}}).then(function(e){var t=e[0];i("styleUpdate",{id:t.node.id}).then(function(){n(null)},function(e){r(e)})})}):function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,i("styleInstall")];case 1:return e.sent(),[4,d(getMeta("stylish-install-ping-url-chrome"))];case 2:return[2,e.sent()]}})})}()).then(t,t))}function i(u,l){return void 0===l&&(l={}),__awaiter(this,void 0,void 0,function(){var r,o,s,i,a;return __generator(this,function(e){switch(e.label){case 0:return r="styleInstall"===u,function(e){var t=function(e){return e.replace(/;/g,"!important;")},n=document.getElementById("update_style_button");if(n){n.style.cssText=e?"":t("pointer-events: none; opacity: .35;");var r=n.querySelector('img[src*=".svg"]');r&&(r.style.cssText=e?"":t("transition: transform 5s; transform: rotate(0);"),e&&setTimeout(function(){return r.style.cssText+=t("transform: rotate(10turn);")}))}}(!1),r?(s=(o=browserAPI.runtime).sendMessage,i={type:"styleInstall"},a={downloadURL:location.href,type:"userstyles.org"},[4,d((t=getMeta("stylish-update-url")||"",n=getMeta("stylish-code-chrome")||t.replace(/styles\/(\d+)\/[^?]*/,"styles/chrome/$1.json"),n+(-1===n.indexOf("?")&&-1!==t.indexOf("?")?t.replace(/^[^?]+/,""):"")))]):[3,3];case 1:return[4,s.apply(o,[(i.data=(a.code=e.sent(),a.author=document.querySelector("#style_author a")?document.querySelector("#style_author a").innerText:"anonymous",a),i)])];case 2:return e.sent(),c({type:"styleInstalledChrome",detail:{}}),[3,5];case 3:return[4,browserAPI.runtime.sendMessage({type:"updateStylesheet",data:{nodeId:l.id}})];case 4:e.sent(),e.label=5;case 5:return[2]}var t,n})})}function a(){return"loading"!==document.readyState?Promise.resolve():new Promise(function(t){document.addEventListener("DOMContentLoaded",function e(){document.removeEventListener("DOMContentLoaded",e),t(null)})})}function d(r){return new Promise(function(e){if(r)if(0!=r.indexOf("#")){var t=new XMLHttpRequest;if(t.onreadystatechange=function(){4==t.readyState&&(400<=t.status?e(null):e(t.responseText))},2e3<r.length){var n=r.split("?");t.open("POST",n[0],!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.send(n[1])}else t.open("GET",r,!0),t.send()}else e(document.getElementById(r.substring(1)).innerText);else e(null)})}new(window.MutationObserver||window.WebkitMutationObserver)(e).observe(document.documentElement,{childList:!0,subtree:!0}),e()}(),document.documentElement.appendChild(document.createElement("script")).text="("+function(o,r){if(document.currentScript.remove(),r){var s=window.Image,e=function(e,t){var n=new s(e,t),r={};return window.setInterval(function(){n.src&&!r[n.src]&&/^chrome-extension:/i.test(n.src)&&(r[n.src]=!0,setTimeout(function(){return"function"==typeof n.onload&&n.onload()}))},125),n};window.Image=e}var i;window!==top&&"/"===location.pathname&&window.addEventListener("message",function(e){var t=e.data,n=e.origin;if(t&&t.xhr&&n===o){var r=new XMLHttpRequest;r.onloadend=r.onerror=function(){window.stop(),top.postMessage({id:t.xhr.id,status:r.status,response:r.response},o)},r.open("GET",t.xhr.url),r.send()}});var a=Response.prototype.json;document.addEventListener("stylusFixBuggyUSOsettings",function e(t){var n=t.detail;document.removeEventListener("stylusFixBuggyUSOsettings",e),(i=r&&52<=parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10)?/\?/.test(n)&&new URLSearchParams(new URL(n).search):/\?/.test(n)&&new URLSearchParams(new URL(n).search.replace(/^\?/,"")))||(Response.prototype.json=a)}),Response.prototype.json=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a.call.apply(a,[this].concat(e)).then(function(e){if(!i||"function"!=typeof((e||{}).style_settings||{}).every)return e;Response.prototype.json=a;for(var l=[],t=function(e){var t=i.get("ik-"+e.install_key);if(!t||!e.style_setting_options||!e.style_setting_options[0])return"continue";if(t.startsWith("ik-")){t=t.replace(/^ik-/,"");for(var n=null,r=0;r<e.style_setting_options.length;r++)if(e.style_setting_options[r].default){n=e.style_setting_options[r];break}var o=n;o&&o.install_key===t||(o&&(o.default=!1),e.style_setting_options.filter(function(e){return e.install_key===t&&(e.default=!0)}).length)}else if("image"===e.setting_type)e.style_setting_options.some(function(e){return!!e.default&&(e.default=!1,!0)}).length,l.push([e.install_key,t]);else{(n=e.style_setting_options[0]).value!==t&&"placeholder"===n.install_key&&(n.value=t)}},n=0,r=e.style_settings;n<r.length;n++){t(r[n])}return l.length&&new MutationObserver(function(e,t){if(document.getElementById("style-settings")){t.disconnect();for(var n=0,r=l;n<r.length;n++){var o=r[n],s=o[0],i=o[1],a=document.querySelector('input[name="ik-'+s+'"][value="user-url"]'),u=a&&document.getElementById(a.id.replace("url-choice","user-url"));u&&(u.value=i)}}}).observe(document,{childList:!0,subtree:!0}),e})}}+")('"+browserAPI.runtime.getURL("").slice(0,-1)+"', "+("chrome"===BrowserAPI.getBrowser())+")",-1!==location.search.indexOf("category=")&&document.addEventListener("DOMContentLoaded",function e(){document.removeEventListener("DOMContentLoaded",e),new MutationObserver(function(e,t){if(document.getElementById("pagination")){t.disconnect();for(var n="&"+location.search.match(/category=[^&]+/)[0],r=document.querySelectorAll('#pagination a[href*="page="]:not([href*="category="])'),o=0;o<r.length;o++)r[o].href+=n}}).observe(document,{childList:!0,subtree:!0})});